#!/bin/sh
# postinst script for ldapsp
#
# see: dh_installdeb(1)

set -e

add_users_groups()
{
  if ! getent group ldapsp >/dev/null; then
    addgroup --system ldapsp
  fi

  if ! getent passwd ldapsp >/dev/null; then
    adduser --ingroup=ldapsp --quiet --system --home=/opt/ldapsp ldapsp
  fi
}

add_statoverrides()
{
    OVERRIDES="\
         /etc/ldapsp/ \
         /etc/ldapsp/ldapsp.conf \
         /etc/ldapsp/policy.erl \
         /var/log/ldapsp \
         /opt/ldapsp
    "

    for f in ${OVERRIDES}; do
        if ! dpkg-statoverride --list "${f}" >/dev/null 2>&1; then
            [ ! -e "${f}" ] || chown ldapsp "${f}"
        fi
    done

    f=/etc/ldapsp/ldapsp.conf
    if ! dpkg-statoverride --list "${f}" >/dev/null 2>&1; then
            [ ! -e "${f}" ] || chmod 0640 "${f}"
    fi

    f=/var/log/ldapsp
    if ! dpkg-statoverride --list "${f}" >/dev/null 2>&1; then
            [ ! -e "${f}" ] || chgrp adm "${f}"
    fi
}


case "$1" in
  configure)
    add_users_groups
    add_statoverrides
  ;;

  abort-upgrade|abort-remove|abort-deconfigure)
  ;;

  *)
    echo "postinst called with unknown argument \`$1'" >&2
    exit 1
  ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
